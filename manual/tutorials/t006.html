<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<!-- UASR: Unified Approach to Speech Synthesis and Recognition
<    - Documentation home page
<   
<    AUTHOR : Matthias Wolff
<    PACKAGE: n/a
<   
<    Copyright 2013-2014 UASR contributors (see COPYRIGHT file)
<    - Chair of System Theory and Speech Technology, TU Dresden
<    - Chair of Communications Engineering, BTU Cottbus
<   
<    This file is part of UASR.
<   
<    UASR is free software: you can redistribute it and/or modify it under the
<    terms of the GNU Lesser General Public License as published by the Free
<    Software Foundation, either version 3 of the License, or (at your option)
<    any later version.
<   
<    UASR is distributed in the hope that it will be useful, but WITHOUT ANY
<    WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
<    FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for 
<    more details.
<   
<    You should have received a copy of the GNU Lesser General Public License
<    along with UASR. If not, see [http://www.gnu.org/licenses/].
  -->
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Tutorial 6 - Search processor</title>
  <link rel=stylesheet type="text/css" href="../default.css">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
 <style type="text/css"><!--
 .tiny {font-size:30%;}
 .scriptsize {font-size:xx-small;}
 .footnotesize {font-size:x-small;}
 .smaller {font-size:smaller;}
 .small {font-size:small;}
 .normalsize {font-size:medium;}
 .large {font-size:large;}
 .larger {font-size:x-large;}
 .largerstill {font-size:xx-large;}
 .huge {font-size:300%;}
 --></style>
</head>
<script type="text/javascript">
if (top==self)
{
  var sLocation = "../index.html?tutorials/t006.html";
  if (location.hash.length>0)
    sLocation += ";"+location.hash.substr(1);
  top.location = sLocation;
}
</script>
<script type="text/javascript" src="../default.js"></script>
<body>
  <a name="top"></a>
  <div id="clp_top">
    <table width="100%" cellpadding="0" cellspacing="0" border="0">
      <tr>
        <td nowrap width="25%" class="navbar">
          Tutorial 6 - Search processor
        </td>
        <td nowrap width="75%" class="navbar" style="text-align:right;">
          <a class="navbar" href="javascript:__PrintSection('clp_top','Tutorial 5 - Mathematics','..');"
          ><img src="../resources/print.gif" width="16" height="16" border="0" style="vertical-align:middle;" 
          alt="Print"></a>
          <a class="navbar" href="../home.html">Home</a>
          <a class="navbar" href="index.html">Tutorials</a>
        </td>
      </tr>
    </table>
    <div class="mframe">
      <table width="100%" cellSpacing="0" cellPadding="6" border="0">
        <tr>
          <td width="50%">
            <h3 style="margin-top:2pt; margin-bottom:2pt">Contents</h3>
            <ul class="linklist">
              <li class="linklist"><a class="Linklist" href="#fst">Introduction into wFSTs</a></li>
              <li class="linklist"><a class="Linklist" href="#if">Search processor interface</a></li>
              <li class="linklist"><a class="Linklist" href="#algo">Algorithm's workflow</a></li>
              <li class="linklist"><a class="Linklist" href="#further">Further Reading</a></li>
            </ul>
          </td>
          <td width="50%">
            <h3 style="margin-top:2pt; margin-bottom:2pt">Related Topics</h3>
            <ul class="linklist">
              <li class="linklist"><a class="Linklist" href="t001.html">Tutorial 1 - dLabPro Basics</a></li>
              <li class="linklist"><a class="Linklist" href="t002.html">Tutorial 2 - Variables and Data Containers</a></li>
              <li class="linklist"><a class="Linklist" href="t003.html">Tutorial 3 - Writing Scripts</a></li>
            </ul>
          </td>
        </tr>
      </table>
    </div>
    <div class="mframe2">
      <h3>Synopsis</h3>
      <p>Explains how to use the search processor for decoding wFSTs.</p>
      
      <span class="warning">This is an incomplete,
          preliminary document and subject to changes.</span>
    </div>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <a name="fst"></a>
    <div id="clp_fst">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap width="25%" class="navbar">
            Introduction into wFSTs
          </td>
          <td nowrap width="75%" class="navbar" style="text-align:right;">
            <a class="navbar" href="javascript:__PrintSection('clp_fst','Basic Matrix Operations','..');"
            ><img src="../resources/print.gif" width="16" height="16" border="0" style="vertical-align:middle;" alt="Print"></a> 
            <a class="navbar" href="../home.html">Home</a>
            <a class="navbar" href="index.html">Tutorials</a>
            <a class="navbar" href="#top">Top</a>
          </td>
        </tr>
      </table>
      <div class="mframe2">
        <p>First we will start with a short introduction into weighted finite state transducers (wFSTs).
          A wFSTs <i>A</i> = (Z,I,F,X,Y,S,E) consisting of:</p>
<ul>
<li> a finite set of states Z = { z<sub>0</sub>,z<sub>1</sub>,&#8230;}, </li>
<li> a set of initial states I  &#8838; Z, </li>
<li> a set of final states F  &#8838; Z, </li>
<li> an input alphabet X = { &#1013;,x<sub>0</sub>,x<sub>1</sub>,&#8230;}, </li>
<li> an output alphabet Y = { &#1013;,y<sub>0</sub>,y<sub>1</sub>,&#8230;}, </li>
<li> a weight semiring S={<b>K</b>,&#8853;,&#8855;,<span class="overacc2">&#x2015;</span>0,<span class="overacc2">&#x2015;</span>1} and </li>
<li> a multi-set of transitions E  &#8838; Z &times;X &times;Y &times;<b>K</b> &times;Z. </li>
</ul>

<p>A transition e &#8712; E leads from state z(e) to state z&#8242;(e).
Thereby the input symbol x(e) is consumed and the output symbol y(e) is emitted.
w(e) denotes the weight of the transition.</p>

<p>A path U = (e<sub>1</sub>,&#8230;,e<sub>K</sub>) is a sequence of connected transitions with z&#8242;(e<sub>i</sub>) = z(e<sub>i+1</sub>)
	with the path weight w(U).
The path with the best weight from any of the initial states to the state z is denoted by U<sup>*</sup>(z).</p>

<p>This best path is exactly the item of interest for automatic pattern recognition.
It represents the recognition result with the best matching to the observed feature vector sequence.
The task of the search algorithm is to find the best path.</p>

<p>To get a bit more familiar with wFSTs we will introduce a small example automaton.
It will be used through the whole tutorial for demonstration of the search processor.
Below you see the example in <a href="http://www.openfst.org/twiki/bin/view/FST/WebHome">openfst</a> text file representation.
The example is named &quot;rn&quot; which stands for recognition network.
Each line in the text file is one transition.
Represented by it's initial state index, the finial state index, the input symbol index, the output symbol index and the weight.
A line (like the last one in the example) with one number marks this state as final state.</p>

        <pre class="code"><span class="c-cmt">Example rn.txt</span>
0 1  0  0 5
0 2  1  1 5
1 1  0 -1 2
2 2  1 -1 1
1 2  1  1 5
1 3 -1  2 0
2 3 -1  2 0
3</pre>

<p>If you save it to a text file named &quot;rn.txt&quot;,
you can load and display the wFST with the following dLabPro code.

        <pre class="code">
dLabPro&gt; <a href="../automatic/fst.html"><code class="link">fst</code></a> rn;
dLabPro&gt; "rn.txt" "fsm-t" rn <a href="../automatic/file.html"><code class="link">stdfile</code></a> <a href="../automatic/file.html#mth_-import"><code class="link">-import</code></a>;
dLabPro&gt; rn <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   Data content of instance
   fst rn
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   Units      : 1    (unit table      : 'ud')
   States     : 4    (state table     : 'sd')
   Transitions: 7    (transition table: 'td')
   In-Symbols : 0    (input symbol t. : 'is')
   Out-Symbols: 0    (output symbol t.: 'os')

   Acceptor   : yes
   Transducer : yes
   Weights    : tropical semiring
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 - - - - - - - - - -
 Unit 0
   Name              : 'fsm'
   States            : 4    (offset: 0)
   Transitions       : 7    (offset: 0)

   Loops             : yes
   Forward connected : yes
   Backward connected: yes
   Forward tree      : no
   Backward tree     : no

   States
     [no custom descriptors]

   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next              0            0         5
        1:       0  -&gt;       2    2next             1            1         5
        2:       1  -&gt;       1    loop              0           -1         2
        3:       2  -&gt;       2    loop              1           -1         1
        4:       1  -&gt;       2    next              1            1         5
        5:       1  -&gt; (     3)   end              -1            2         0
        6:       2  -&gt; (     3)   end              -1            2         0
 No more data - Stop.
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</pre>
        
        <p>In <a href="javascript:__goUasr()">UASR</a> there is a function named <a href="javascript:__goUasr('automatic/util/fst.itp.html','clp_-FST_render')">-FST_render</a>
        which can be used to get a graphical representation of the automaton.
        Here you see the states and it's transitions.
        Final states are marked with double circles and the transitions are labeled with:
        &quot;Input symbol : Output symbol | Weight&quot;.</p>

        <img src="../resources/tutorials/fstsearch_rn_img.gif" border="0" alt="Example for recognition network">

        <p>For more details on wFSTs and supported operations in dLabPro see manual of class <a href="../automatic/fst.html"><code class="link">fst</code></a>.</p>

      </div>
    </div>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <a name="if"></a>
    <div id="clp_if">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap width="25%" class="navbar">
            Search processor interface
          </td>
          <td nowrap width="75%" class="navbar" style="text-align:right;">
            <a class="navbar" href="javascript:__PrintSection('clp_if','Matrix-Vector Operations','..');"
            ><img src="../resources/print.gif" width="16" height="16" border="0" style="vertical-align:middle;" alt="Print"></a> 
            <a class="navbar" href="../home.html">Home</a>
            <a class="navbar" href="index.html">Tutorials</a>
            <a class="navbar" href="#top">Top</a>
          </td>
        </tr>
      </table>
      <div class="mframe2">
        <p>The search processor in dLabPro provides a algorithm independent interface to several search algorithms.
        It is implemented in the class <a href="../automatic/fstsearch.html"><code class="link">fstsearch</code></a>.
        Here we will give some examples how to use the search processor and how to configure it.</p>

        <h3>Timevariant decoding</h3>

        <p>Timevariant decoding is the most common decoding method in acoustic pattern recognition.
        In addition to the recognition network (see previous section) there is a vector weights which change in every time step.
        Usually each vector is derived from feature vector of that time step by the Gaussian mixture model (see class <a href="../automatic/gmm.html"><code class="link">gmm</code></a> and <a href="../automatic/gmm.html"><code class="link">hmm</code></a>).
        But the origin of the timevariant weights does not influence the search algorithm.</p>

        <p>The timevariant weight vectors can be combined to a timevariant weight matrix.
        For demonstration we will generate a small matrix with a vector dimension of two and four time steps or vectors:</p>

        <pre class="code">
dLabPro&gt; <a href="../automatic/data.html"><code class="link">data</code></a> w;
dLabPro&gt; {
           { 2 0 }
           { 0 9 }
           { 0 3 }
           { 6 0 }
         } w =;</pre>

        <p>The timevariant weights are connected to the recognition network by the input symbols of the network.
        In traversing a path for each transition the total transition weight consists of
        the timeinvariant weight (w(e)) in the automaton and the timevariant weight of the current time step and the vector element
        indexed by the input symbol of the transition (w(k,x(e)).
        Transitions with empty input symbol (x(e)=-1) have no timevariant weight.</p>

        <p>The following code initializes a search processor <code>s</code> and the result automaton <code>res</code>.
        Then the recognition network <code>rn</code> is loaded by <a href="../automatic/fstsearch.html#mth_-load"><code class="link">-load</code></a>.
        The second argument <code>0</code> indicates that the first unit within the fst object should be used.
        In the next step the search is performed with <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a> by using the timevariant weight matrix <code>w</code>.
        The option <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> forces the search to run until a final state is reached.
        Through backtracking with <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a> we get the best decoded path in form of another wFST.
        The loaded recognition network can be freed by <a href="../automatic/fstsearch.html#mth_-reset"><code class="link">-reset</code></a>.</p>

        <pre class="code">
dLabPro&gt; <a href="../automatic/fstsearch.html"><code class="link">fstsearch</code></a> s;
dLabPro&gt; <a href="../automatic/fst.html"><code class="link">fst</code></a> res;
dLabPro&gt; rn 0 s <a href="../automatic/fstsearch.html#mth_-load"><code class="link">-load</code></a>;
dLabPro&gt; w s <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; res s <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next             -1            0        11
        1:       1  -&gt;       2    next             -1            1         5
        2:       2  -&gt; (     3)   end              -1            2         0
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_tv_tp_os.gif" border="0" alt="Decoding result"></pre>

        <p>The result automaton is a chain of the output symbols of the best path.
        The transition weights are combined total transition weights.
        To get the whole path (every transition used in the recognition network)
        we have to change the backtracking mode <a href="../automatic/fstsearch.html#fld_bt"><code class="link">bt</code></a> before decoding:</p>

        <pre class="code">
dLabPro&gt; &quot;t&quot; s -set <a href="../automatic/fstsearch.html#fld_bt"><code class="link">bt</code></a>;
dLabPro&gt; w s <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; res s <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next              0            0         7
        1:       1  -&gt;       2    next              0           -1         2
        2:       2  -&gt;       3    next              0           -1         2
        3:       3  -&gt;       4    next              1            1         5
        4:       4  -&gt; (     5)   end              -1            2         0
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_tv_tp_t.gif" border="0" alt="Decoding result"></pre>

        <p>Now we can see by comparing input and output symbols with the recognition network,
        that the best path with that timevariant weight matrix starts from state <code>0</code> to state <code>1</code>
        the stays at state <code>1</code> for two time steps before finishing over state <code>2</code>.
        The transition weights in the result object nevertheless represent total transition weights,
        which is the combination of timeinvariant and timevariant weight.
        In the example you see that for the first transition the timeinvariant weight <code>5</code> is combined with the timevariant weight <code>2</code>
          to <code>7</code> using the tropical semiring multiplication operation which corresponds to mathematical addition.</p>

        <p>There is also another method named <a href="../automatic/fst.html#mth_-search"><code class="link">-search</code></a> which
        combines the usual procedure into one call.
        It loads the recognition network, performs the search and the backtracking and gives all memory free:</p>

        <pre class="code">
dLabPro&gt; rn 0 w res s <a href="../automatic/fst.html#mth_-search"><code class="link">-search</code></a>;</pre>

        <h3>Iterative timevariant decoding</h3>

        <p>Sometimes it is useful to perform the search while the signal is collected.
        So the computing capacity is used more regular and it is possible to present interim results.
        This is also possible with the search processor in dLabPro.</p>

        <p>You simply need to omit the <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> option at the call to <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>.
        Only the last call should be made with the <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> option.
        <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a> is possible at every time step and gives an interim recognition result.</p>

        <p>The following code shows an iterative decoding for the used example.
        In the first two decoding steps only first and second timevariant weight vector is passed to the search algorithm.
        In the third step the third and fourth timevariant weight vector are passed together
          and in the last step the search is finished without timevariant weights (<code>NULL</code>).
        From the interim results you see,
          that after the first decoding step another path is the best one
          before there algorithm switches to the final best one in the second decoding step.</p>

        <pre class="code">
dLabPro&gt; rn 0 s <a href="../automatic/fstsearch.html#mth_-load"><code class="link">-load</code></a>;
<span class="c-cmt">---- Decode frame 1 ----</span>
dLabPro&gt; 0 1 w <a href="../automatic/data.html#opt__rec"><code class="link">/rec</code></a> <a href="../automatic/data.html#mth_-xfetch"><code class="link">-xfetch</code></a> s <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; res s <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt; (     1)   end               1            1         5
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_tv_tp_t_1.gif" border="0" alt="Decoding result">
<span class="c-cmt">---- Decode frame 2 ----</span>
dLabPro&gt; 1 1 w <a href="../automatic/data.html#opt__rec"><code class="link">/rec</code></a> <a href="../automatic/data.html#mth_-xfetch"><code class="link">-xfetch</code></a> s <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; res s <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next              0            0         7
        1:       1  -&gt; (     2)   end               0           -1         2
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_tv_tp_t_2.gif" border="0" alt="Decoding result">
<span class="c-cmt">---- Decode frame 3 and 4 ----</span>
dLabPro&gt; 2 2 w <a href="../automatic/data.html#opt__rec"><code class="link">/rec</code></a> <a href="../automatic/data.html#mth_-xfetch"><code class="link">-xfetch</code></a> s <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; res s <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next              0            0         7
        1:       1  -&gt;       2    next              0           -1         2
        2:       2  -&gt;       3    next              0           -1         2
        3:       3  -&gt; (     4)   next              1            1         5
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_tv_tp_t_3.gif" border="0" alt="Decoding result">
<span class="c-cmt">---- Finalize decoding ----</span>
dLabPro&gt; NULL s <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; res s <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next              0            0         7
        1:       1  -&gt;       2    next              0           -1         2
        2:       2  -&gt;       3    next              0           -1         2
        3:       3  -&gt;       4    next              1            1         5
        4:       4  -&gt; (     5)   end              -1            2         0
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_tv_tp_t_4.gif" border="0" alt="Decoding result">
</pre>

        <h3>Timeinvariant decoding</h3>

        <p>The search processor is also enabled for timeinvariant decoding.
        Timeinvariant decoding simply finds the best path only guided by the timeinvariant weights.
        So for running the search you should replace the timevariant weight matrix with <code>NULL</code>.
        In the result below you see that the best path through our small recognition network is the one from state <code>0</code> over state <code>2</code> to state <code>3</code> with a total path weight of <code>5</code>.</p>

        <pre class="code">
dLabPro&gt; rn 0 NULL res s <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> <a href="../automatic/fst.html#mth_-search"><code class="link">-search</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next              0            0         5
        1:       1  -&gt; (     2)   end              -1            2         0
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_iv_tp_t.gif" border="0" alt="Decoding result"></pre>

        <h3>Very simple method of on-the-fly composition</h3>

        <p>The search processor integrates a very simple method for on-the-fly composition.
        It is not a real composition,
          but a way to jump between different wFST units by input symbols.</p>

        <p>To use it you have to load multiple units.
        The units are divided into lowest layer units (<code>&ne;0</code>) and higher layer units (<code>=0</code>) by the flag component <code>&quot;&tilde;SUB&quot;</code> in the unit description table (<code>rn.ud</code>).
        In the higher layer units are interpreted as unit indices of units which are inserted for that transition.
        The decoding algorithm jumps on traversing the transition e to the unit x(e) and continues decoding from transition e not until a final state in the sub unit is reached.
        In the lowest layer units the input symbols are treated as usual.
        Decoding starts in unit <code>0</code>.</p>

        <p>To come to our small example we have to extend it a little bit.
        A second automaton is created by the following text file.
        It will be used as higher layer unit.
        The previous recognition network will be used as lower layer unit.
        The new wFST simply repeats the input symbol <code>1</code> any number of times.
        So the previous recognition network may be repeated.
        For each repetition there is a weight of <code>2</code>.</p>

        <pre class="code"><span class="c-cmt">Example rn2.txt</span>
0 0  1 -1 2
0</pre>

        <p>The following code loads the new wFST <code>rn2</code> and combines it with the previous one.
        The component &quot;&tilde;SUB&quot; is created and the first unit is marked as higher layer unit.</p>

        <pre class="code">
dLabPro&gt; <a href="../automatic/fst.html"><code class="link">fst</code></a> rn2;
dLabPro&gt; "rn2.txt" "fsm-t" rn2 <a href="../automatic/file.html"><code class="link">stdfile</code></a> <a href="../automatic/file.html#mth_-import"><code class="link">-import</code></a>;
dLabPro&gt; rn rn2 <a href="../automatic/fst.html#mth_-cat"><code class="link">-cat</code></a>;
dLabPro&gt; &quot;&tilde;SUB&quot; -type int rn2.ud <a href="../automatic/data.html#mth_-addcomp"><code class="link">-addcomp</code></a>;
dLabPro&gt; :rn2.ud[0,&quot;&tilde;SUB&quot;]=1;</pre>

        <p>Now the recognition network with it's two units looks like:</p>

        <pre class="code">
dLabPro&gt; rn2 <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0: (     0) -&gt; (     0)   end               1           -1         2
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next              0            0         5
        1:       0  -&gt;       2    2next             1            1         5
        2:       1  -&gt;       1    loop              0           -1         2
        3:       2  -&gt;       2    loop              1           -1         1
        4:       1  -&gt;       2    next              1            1         5
        5:       1  -&gt; (     3)   end              -1            2         0
        6:       2  -&gt; (     3)   end              -1            2         0
<span class="c-cmt">  . . .</span>
U0: <img src="../resources/tutorials/fstsearch_rn2_img.gif" border="0" style="vertical-align:middle;" alt="Example for recognition network #2"> U1: <img src="../resources/tutorials/fstsearch_rn_img.gif" border="0" style="vertical-align:middle;" alt="Example for recognition network"></pre>
        
        <p>And the unit table holds the flag component &quot;&tilde;SUB&quot;:</p>

        <pre class="code">
dLabPro&gt; rn2.ud <a href="../automatic/data.html#mth_-print"><code class="link">-print</code></a>;
 data ud
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
           0   1
         ... ...
 0 &tilde;NAM: fsm fsm
 1  &tilde;XS:   1   4
 2  &tilde;XT:   1   7
 3  &tilde;FS:   0   1
 4  &tilde;FT:   0   1
 5 &tilde;SUB:   1   0
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</pre>

        <p>In loading the recognition network the unit index <code>-1</code> signals that all units should be loaded.
        For decoding we will use the timevariant weight matrix twice in sequence.
        This can easily be realized by iterative decoding with two calls to <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>.</p>

        <pre class="code">
dLabPro&gt; rn2 -1 s <a href="../automatic/fstsearch.html#mth_-load"><code class="link">-load</code></a>;
dLabPro&gt; w s <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; w s <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; res s <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next             -1           -1         2
        1:       1  -&gt;       2    next              0           -1         7
        2:       2  -&gt;       3    next              0           -1         2
        3:       3  -&gt;       4    next              0           -1         2
        4:       4  -&gt;       5    next              1           -1         5
        5:       5  -&gt;       6    next              1           -1         1
        6:       6  -&gt;       7    next             -1           -1         0
        7:       7  -&gt;       8    next             -1           -1         2
        8:       8  -&gt;       9    next              0           -1         5
        9:       9  -&gt;      10    next              0           -1         2
       10:      10  -&gt;      11    next              1           -1         5
       11:      11  -&gt; (    12)   end              -1           -1         0
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_sub_tv_tp_t_img.gif" border="0" alt="Decoding result"></pre>

        <p>The decoding results shows,
          that the best path traverses the second unit twice.
        For the first time the first five time steps are consumed with input symbols <code>0,0,0,1,1</code>.
        In the second traverse the last three time steps are consumed with input symbols <code>0,0,1</code>.
        So the total path weight is <code>33</code> which consists of <code>17</code> and <code>12</code> for the first and second traverse and <code>4</code> for two repetitions.
        This is lower that two times the path weight in the single recognition network (<code>16</code>) and the repetition weight <code>4</code>.</p>

        <h3>Changing the search algorithm</h3>

        <p>The search algorithm used for decoding is configured by the field <a href="../automatic/fstsearch.html#fld_algo"><code class="link">algo</code></a>.
        Available algorithm are listed in the <a href="../automatic/fstsearch.html#fld_algo">field documentation</a>.
        In the following section is a closer look on the token passing (<code>&quot;tp&quot;</code>) and the A* algorithm (<code>&quot;as&quot;</code>).
        All previous examples are based on the token passing algorithm as this is the default algorithm.
        The small example can be decoded using the A* algorithm with the following code:</p>

        <pre class="code">
dLabPro&gt; rn 0 s <a href="../automatic/fstsearch.html#mth_-load"><code class="link">-load</code></a>;
dLabPro&gt; &quot;as&quot; s -set <a href="../automatic/fstsearch.html#fld_algo"><code class="link">algo</code></a>;
dLabPro&gt; w s <a href="../automatic/fstsearch.html#opt__final"><code class="link">/final</code></a> <a href="../automatic/fstsearch.html#mth_-isearch"><code class="link">-isearch</code></a>;
dLabPro&gt; res s <a href="../automatic/fstsearch.html#mth_-backtrack"><code class="link">-backtrack</code></a>;
dLabPro&gt; res <a href="../automatic/fst.html#mth_-print"><code class="link">-print</code></a>;
<span class="c-cmt">  . . .</span>
   Transitions
         :  initial -&gt; terminal   type        ~TIS      ~TOS      ~TSR
        0:       0  -&gt;       1    next              0            0         5
        1:       1  -&gt;       2    next              0           -1        16
        2:       2  -&gt;       3    next              0           -1        -2
        3:       3  -&gt;       4    next              1            1         0
        4:       4  -&gt; (     5)   end              -1            2        -3
<span class="c-cmt">  . . .</span>
<img src="../resources/tutorials/fstsearch_res_tv_as_t.gif" border="0" alt="Decoding result"></pre>

        <p>In comparison to previous results you may see,
          that the result of the A* algorithm only matches in input and output symbols.
        The transitions weights differ.
        Though the optimization based heuristics for remaining timevariant and timeinvariant weight inside the A* decoder
          some of the weights are shifted towards the initial state.
        The total path weight is identical to the token passing decoder and so is the path itself.</p>

       </div>
    </div>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <a name="algo"></a>
    <div id="clp_algo">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap width="25%" class="navbar">
            Algorithm's workflow
          </td>
          <td nowrap width="75%" class="navbar" style="text-align:right;">
            <a class="navbar" href="javascript:__PrintSection('clp_algo','Other Matrix Operations','..');"
            ><img src="../resources/print.gif" width="16" height="16" border="0" style="vertical-align:middle;" alt="Print"></a> 
            <a class="navbar" href="../home.html">Home</a>
            <a class="navbar" href="index.html">Tutorials</a>
            <a class="navbar" href="#top">Top</a>
          </td>
        </tr>
      </table>
      <div class="mframe2">

        <h3>Token passing algorithm</h3>

        <p>The token passing principle was introduced by Young, Russell and Thornton [1].
        Currently the most used decoding algorithms in automatic speech recognition are token passing ones.
        To be more precise the token passing principle is adapted to a time synchronous Viterbi beam search.
        This section gives a short and informal introduction into the token passing decoder implementation in dLabPro's search processor.</p>

        <p><small>[1] S. J. Young, N. H. Russell and J. H. S. Thornton:
        &quot;Token Passing: a Simple Conceptual Model for Connected Speech Recognition Systems&quot;,
        Cambridge University Engineering Department, Tech. Rep., Jul. 1989.</small></p>

        <p>The idea of the token passing principle is to have tokens traversing the search space.
        These tokens carry all information needed for decoding and backtracking.
        Mainly the current state and time index,
          the path weight from initial to current state and
          generated output symbol sequence.</p>

        <p>If a token traverses the state it is duplicated for every outgoing transition,
          so there is a new token at every following state and the old one is discarded.
        This is called state expansion.
        A queue is used to hold all active tokens ready for expansion.</p>

        <p>In time synchronous decoding the tokens are processed time synchronously.
        Meaning all tokens of the current time step are expanded before the next time step.
        Therefore two queues are used,
          for the current time step and for the next one.
        If the first queue is empty,
          the second one becomes the first one and
          a new queue is initialized for the following time step.
        The search terminates if the queue of the last time step is empty.</p>

        <p>The figure below shows the process of token passing decoding in the small example of the previous section.
        The recognition network is arranged vertically and the timevariant weight matrix horizontal also displayed as automaton.
        Output symbols are skipped for clarity.
        The time step of the current queue is displayed in green and next time step in blue.
        Red states and transitions are currently expanding ones.</p>

        <img src="../resources/tutorials/fstsearch_tp.gif" border="0" alt="Token passing algorithm process">

        <h3>A* algorithm</h3>

        <p><span class="TODO">[<b>TODO:</b> ...]</span></p>

        <img src="../resources/tutorials/fstsearch_as.gif" border="0" alt="A* algorithm process">
        <img src="../resources/tutorials/fstsearch_as_queue.gif" border="0" alt="A* algorithm queue process">
      </div>
    </div>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <a name="further"></a>
    <div id="clp_tp">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap width="25%" class="navbar">
            Further Reading
          </td>
          <td nowrap width="75%" class="navbar" style="text-align:right;">
            <a class="navbar" href="javascript:__PrintSection('clp_further','Further Reading','..');"
            ><img src="../resources/print.gif" width="16" height="16" border="0" style="vertical-align:middle;" alt="Print"></a> 
            <a class="navbar" href="../home.html">Home</a>
            <a class="navbar" href="index.html">Tutorials</a>
            <a class="navbar" href="#top">Top</a>
          </td>
        </tr>
      </table>
      <div class="mframe2">
        <ul class="linklist">
          <li class="linklist"><a href="../automatic/fstsearch.html"><img
          src="../resources/class_obj.gif" width="16" height="16" border="0"
          style="vertical-align:middle" alt="icon">&nbsp;Class fstsearch</a></li>
          <li class="linklist"><a href="../automatic/fst.html"><img
          src="../resources/class_obj.gif" width="16" height="16" border="0"
          style="vertical-align:middle" alt="icon">&nbsp;Class fst</a></li>
        </ul>
      </div>
    </div>
  
  </div>
  <div class="footer">End of page</div>

</body>
</html>
